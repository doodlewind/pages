var Merry8=function(){"use strict";function n(n){return 224===n?["00E0","CLS"]:238===n?["00EE","RET"]:n>>>12==0?["0nnn","SYS",4095&n]:n>>>12==1?["1nnn","JP",4095&n]:n>>>12==2?["2nnn","CALL",4095&n]:n>>>12==3?["3xkk","SE",(3840&n)>>>8,255&n]:n>>>12==4?["4xkk","SNE",(3840&n)>>>8,255&n]:n>>>12==5&&0==(15&n)?["5xy0","SE",(3840&n)>>>8,(240&n)>>>4]:n>>>12==6?["6xkk","LD",(3840&n)>>>8,255&n]:n>>>12==7?["7xkk","ADD",(3840&n)>>>8,255&n]:n>>>12==8&&0==(15&n)?["8xy0","LD",(3840&n)>>>8,(240&n)>>>4]:n>>>12==8&&1==(15&n)?["8xy1","OR",(3840&n)>>>8,(240&n)>>>4]:n>>>12==8&&2==(15&n)?["8xy2","AND",(3840&n)>>>8,(240&n)>>>4]:n>>>12==8&&3==(15&n)?["8xy3","XOR",(3840&n)>>>8,(240&n)>>>4]:n>>>12==8&&4==(15&n)?["8xy4","ADD",(3840&n)>>>8,(240&n)>>>4]:n>>>12==8&&5==(15&n)?["8xy5","SUB",(3840&n)>>>8,(240&n)>>>4]:n>>>12==8&&6==(15&n)?["8xy6","SHR",(3840&n)>>>8,(240&n)>>>4]:n>>>12==8&&7==(15&n)?["8xy7","SUBN",(3840&n)>>>8,(240&n)>>>4]:n>>>12==8&&14==(15&n)?["8xyE","SHL",(3840&n)>>>8,(240&n)>>>4]:n>>>12==9&&0==(15&n)?["9xy0","SNE",(3840&n)>>>8,(240&n)>>>4]:n>>>12==10?["Annn","LD",4095&n]:n>>>12==11?["Bnnn","JP",4095&n]:n>>>12==12?["Cxkk","RND",(3840&n)>>>8,255&n]:n>>>12==13?["Dxyn","DRW",(3840&n)>>>8,(240&n)>>>4,15&n]:n>>>12==14&&158==(255&n)?["Ex9E","SKP",(3840&n)>>>8]:n>>>12==14&&161==(255&n)?["ExA1","SKNP",(3840&n)>>>8]:n>>>12==15&&7==(255&n)?["Fx07","LD",(3840&n)>>>8]:n>>>12==15&&10==(255&n)?["Fx0A","LD",(3840&n)>>>8]:n>>>12==15&&21==(255&n)?["Fx15","LD",(3840&n)>>>8]:n>>>12==15&&24==(255&n)?["Fx18","LD",(3840&n)>>>8]:n>>>12==15&&30==(255&n)?["Fx1E","ADD",(3840&n)>>>8]:n>>>12==15&&41==(255&n)?["Fx29","LD",(3840&n)>>>8]:n>>>12==15&&51==(255&n)?["Fx33","LD",(3840&n)>>>8]:n>>>12==15&&85==(255&n)?["Fx35","LD",(3840&n)>>>8]:n>>>12==15&&101==(255&n)?["Fx65","LD",(3840&n)>>>8]:["ERROR",n.toString(16)]}function r(n){function r(){e=e.map(function(n){return n.map(function(n){return 0})})}function t(n,r,t,u){for(var i=u.MEM.filter(function(n,r){return r>=u.I&&r<u.I+t}),a=0;a<8;a++)for(var c=0;c<t;c++){var f=a+n>63?127-(a+n):a+n,V=c+r>31?63-(c+r):c+r;e[f-1][V]=e[f-1][V]^i[c]>>7-a&1}return o(),window.DEBUG&&console.log("Drawing at ("+n+", "+r+") with "+t+" bytes"),!1}function o(){var r=n.width/64;e.forEach(function(n,t){return n.forEach(function(n,o){i.fillStyle=n?"white":"black",i.fillRect(t*r,o*r,r,r)})})}var u=document.querySelector(n.el);u.setAttribute("width",n.width+"px"),u.setAttribute("height",n.width/2+"px");var i=u.getContext("2d"),e=Array.from({length:64},function(n){return Array.from({length:32},function(n){return 0})});return o(),{clear:r,draw:t}}function t(n,r,t){throw console.log("\nLast state:"),console.log({INS:r,V:Array.from(t.V).map(function(n){return n.toString(16)}).join(" "),I:"0x"+t.I.toString(16),PC:"0x"+t.PC.toString(16),SP:t.SP,STACK:t.STACK}),n}function o(n){var r=new Uint8Array(4095),t=[240,144,144,144,240,32,96,32,32,112,240,16,240,128,240,240,16,240,16,240,144,144,240,16,16,240,128,240,16,240,240,128,240,144,240,240,16,32,64,64,240,144,240,144,240,240,144,240,16,240,240,144,240,144,144,224,144,224,144,224,240,128,128,128,240,224,144,144,144,224,240,128,240,128,240,240,128,240,128,128];return n.forEach(function(n,t){r[t+512]=n}),t.forEach(function(n,t){r[t]=n}),r}function u(n,r){if(!(n instanceof r))throw new TypeError("Cannot call a class as a function")}var i=function(){function n(n,r){var t=[],o=!0,u=!1,i=void 0;try{for(var e,a=n[Symbol.iterator]();!(o=(e=a.next()).done)&&(t.push(e.value),!r||t.length!==r);o=!0);}catch(n){u=!0,i=n}finally{try{!o&&a.return&&a.return()}finally{if(u)throw i}}return t}return function(r,t){if(Array.isArray(r))return r;if(Symbol.iterator in Object(r))return n(r,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),e={"0nnn":function(n,r){throw r.PC+=2,Error("0nnn")},"00E0":function(n,r,t){return t.clear(),r.PC+=2,r},"00EE":function(n,r){return r.PC=r.STACK[--r.SP]+2,r},"1nnn":function(n,r){var t=i(n,3),o=t[2];return r.PC=o,r},"2nnn":function(n,r){var t=i(n,3),o=t[2];return r.STACK[r.SP++]=r.PC,r.PC=o,r},"3xkk":function(n,r){var t=i(n,4),o=t[2],u=t[3];return r.V[o]===u?r.PC+=4:r.PC+=2,r},"4xkk":function(n,r){var t=i(n,4),o=t[2],u=t[3];return r.V[o]!==u?r.PC+=4:r.PC+=2,r},"5xy0":function(n,r){var t=i(n,4),o=t[2],u=t[3];return r.V[o]===r.V[u]?r.PC+=4:r.PC+=2,r},"6xkk":function(n,r){var t=i(n,4),o=t[2],u=t[3];return r.V[o]=u,r.PC+=2,r},"7xkk":function(n,r){var t=i(n,4),o=t[2],u=t[3];return r.V[o]+=u,r.PC+=2,r},"8xy0":function(n,r){var t=i(n,4),o=t[2],u=t[3];return r.V[o]=r.V[u],r.PC+=2,r},"8xy1":function(n,r){var t=i(n,4),o=t[2],u=t[3];return r.V[o]=r.V[o]|r.V[u],r.PC+=2,r},"8xy2":function(n,r){var t=i(n,4),o=t[2],u=t[3];return r.V[o]=r.V[o]&r.V[u],r.PC+=2,r},"8xy3":function(n,r){var t=i(n,4),o=t[2],u=t[3];return r.V[o]=r.V[o]^r.V[u],r.PC+=2,r},"8xy4":function(n,r){var t=i(n,4),o=t[2],u=t[3];return r.V[15]=r.V[o]+r.V[u]>255?1:0,r.V[o]=r.V[o]+r.V[u],r.PC+=2,r},"8xy5":function(n,r){var t=i(n,4),o=t[2],u=t[3];return r.V[15]=r.V[o]>r.V[u]?1:0,r.V[o]=r.V[o]-r.V[u],r.PC+=2,r},"8xy6":function(n,r){var t=i(n,4),o=t[2],u=t[3];return r.V[15]=1&r.V[u],r.V[o]=r.V[u]>>1,r.PC+=2,r},"8xy7":function(n,r){var t=i(n,4),o=t[2],u=t[3];return r.V[15]=r.V[u]>r.V[o]?1:0,r.V[o]=r.V[u]-r.V[o],r.PC+=2,r},"8xyE":function(n,r){var t=i(n,4),o=t[2],u=t[3];return r.V[15]=r.V[u]>>7,r.V[o]=r.V[u]<<1,r.PC+=2,r},"9xy0":function(n,r){var t=i(n,4),o=t[2],u=t[3];return r.V[o]!==r.V[u]?r.PC+=4:r.PC+=2,r},Annn:function(n,r){var t=i(n,3),o=t[2];return r.I=o,r.PC+=2,r},Bnnn:function(n,r){var t=i(n,3),o=t[2];return r.PC=o+r.V[0],r},Cxkk:function(n,r){var t=i(n,4),o=t[2],u=t[3];return r.V[o]=parseInt(255*Math.random())&u,r.PC+=2,r},Dxyn:function(n,r,t){var o=i(n,5),u=o[2],e=o[3],a=o[4];return r.V[15]=t.draw(r.V[u],r.V[e],a,r),r.PC+=2,r},Ex9E:function(n,r){var t=i(n,3),o=t[2];return r.KEYS[r.V[o]]?r.PC+=4:r.PC+=2,r},ExA1:function(n,r){var t=i(n,3),o=t[2];return r.KEYS[r.V[o]]?r.PC+=2:r.PC+=4,r},Fx07:function(n,r){var t=i(n,3),o=t[2];return r.V[o]=r.DELAY,r.PC+=2,r},Fx0A:function(n,r){var t=i(n,3),o=t[2],u=parseInt(16*Math.random());return console.log("Mock press",u.toString(16)),r.V[o]=u,r.PC+=2,r},Fx15:function(n,r){var t=i(n,3),o=t[2];return r.DELAY=r.V[o],r.PC+=2,r},Fx18:function(n,r){var t=i(n,3),o=t[2];return r.SOUND=r.V[o],r.PC+=2,r},Fx1E:function(n,r){var t=i(n,3),o=t[2];return r.I=r.I+r.V[o],r.PC+=2,r},Fx29:function(n,r){var t=i(n,3),o=t[2];return r.I=5*r.V[o],r.PC+=2,r},Fx33:function(n,r){var t=i(n,3),o=t[2];return r.MEM[r.I]=Math.floor(r.V[o]/100),r.MEM[r.I+1]=Math.floor(r.V[o]%100/10),r.MEM[r.I+2]=r.V[o]%10,r.PC+=2,r},Fx55:function(n,r){for(var t=i(n,3),o=t[2],u=0;u<=o;u++)r.MEM[r.I++]=r.V[u];return r.PC+=2,r},Fx65:function(n,r){for(var t=i(n,3),o=t[2],u=0;u<=o;u++)r.V[u]=r.MEM[r.I++];return r.PC+=2,r}};return function i(a,c){var f=this;u(this,i),this.run=function(){function r(){var i=5;for(o.DELAY=Math.max(0,o.DELAY-1);i>0;){var a=o.MEM,c=o.PC,f=n(a[c]<<8|a[c+1]);try{e[f[0]](f,o,u)}catch(n){t(n,f,o)}i--}window.requestAnimationFrame(r)}var o=f.c8,u=f.view;window.requestAnimationFrame(r)},this.press=function(n){var r=f.c8.KEYS;r[n]=!0,setTimeout(function(){r[n]=!1},100)},this.rom=a,this.c8={MEM:o(this.rom),V:new Uint8Array(16),STACK:new Uint16Array(16),KEYS:[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1],I:0,PC:512,SP:0,DELAY:0,SOUND:0},this.view=r(c)}}();
